# 项目修改记录 (Project Changes Log)

## 1. 编辑器功能优化 (Editor Enhancements)

### 1.1 自动换行 (Line Wrapping)
- **修改**: 禁用了编辑器的自动换行功能。
- **效果**: 内容将单行显示，超出部分通过底部滚动条查看。

### 1.2 背景高亮 (Background Highlighting)
- **功能**: 为 YAML Front Matter (`---`) 和代码块 (` ``` `) 添加了独立的背景色。
- **细节**:
  - 背景色仅应用于**内容行**，不包含起始和结束的分隔符。
  - 使用了 CodeMirror 的 `ViewPlugin` 和 `syntaxTree` (针对代码块) / Regex (针对 Front Matter) 实现。

### 1.3 选中样式 (Selection Style)
- **修复**: 解决了选中多行文本时，高亮背景色遮挡选中效果或导致文字不可见的问题。
- **实现**: 
  - 调整了 `.cm-selectionLayer` 的 `z-index`。
  - 设置选中背景色为半透明 (`rgba(66, 165, 245, 0.3)`).

### 1.4 Markdown 链接优化 (Link Styling & Interaction)
- **样式**:
  - 链接 `[text](url)` 整体显示为蓝色。
  - 默认折叠 URL 部分，显示为 `[text](...)`。
  - 鼠标移入链接文本显示下划线。
- **交互**:
  - **点击展开**: 点击 `...` 部分，会自动展开完整链接并将光标定位到 URL 开始处。
  - **自动折叠**: 光标移出链接区域后，自动恢复折叠状态。
  - **打开链接**: 支持按住 `Ctrl` (Windows/Linux) 或 `Cmd` (macOS) 并点击链接 (包括文本、URL 或 `...`) 在新标签页打开。

## 2. 主题与样式 (Themes & Styles)

### 2.1 主题配色 (Color Schemes)
- **新增主题**: 除了默认的绿色主题外，新增了 **紫色 (Purple)** 和 **蓝色 (Blue)** 主题。
- **背景统一 (Unified Backgrounds)**:
  - **夜间模式 (Dark Mode)**: 无论使用何种主题色，YAML Front Matter 和代码块的背景色统一使用深灰色 (`#334155`)。
  - **日间模式 (Light Mode)**: 无论使用何种主题色，YAML Front Matter 和代码块的背景色统一使用 **GitHub 风格的浅灰色 (`#f6f8fa`)**。这种中性色调能很好地适应不同主题，提供干净、专业的视觉体验。

### 2.2 CSS 文件结构
- **src/index.css**: 处理全局样式、编辑器选中层级、Markdown 链接样式。
- **src/styles/themes.css**: 定义 CSS 变量 (`--c-brand`, `--c-bg`, `--c-editor-block-bg` 等) 管理不同主题和模式下的颜色。
- **src/components/EditorExtensions.ts**: 封装了所有编辑器增强逻辑 (高亮、链接折叠/点击)。

### 2.6 预览代码块优化 (Preview Code Block)
- **代码块紧凑设计**:
  - **悬浮操作栏**: 移除了原有的代码块头部栏，将语言标识与复制功能合并为一个右上角的悬浮按钮。
  - **自动隐藏**: 悬浮按钮默认隐藏，仅在鼠标悬停在代码块上时显示，最大化代码展示空间。
  - **交互逻辑**: 按钮显示当前语言（如 `JAVA`），点击按钮即可自动复制代码，并反馈 "COPIED" 状态。
  - **视觉优化**: 移除了顶部内边距，保持代码块原始行高和紧凑度，悬浮按钮覆盖在右上角不影响阅读。

### 2.7 编辑器表格优化 (Editor Table)
- **所见即所得表格编辑**:
  - **智能切换**: 当光标在表格外部时，Markdown 表格自动渲染为交互式 HTML 表格 Widget；当光标移入表格区域时，恢复为 Markdown 源码以便进行结构调整。
  - **单元格编辑**: 点击 HTML 表格的任意单元格，即可进入编辑模式（显示输入框）。
  - **实时同步**: 编辑完成后（失焦或回车），内容实时写回 Markdown 源码，保持数据一致性。
  - **样式美化**: 表格 Widget 采用简洁的边框样式，支持 Hover 高亮，提升阅读和编辑体验。
  - **链接渲染**: 表格内的 Markdown 链接 `[text](url)` 会被解析并渲染为可点击的蓝色链接（Ctrl+Click 打开），提升可读性。

### 2.8 引用块优化 (Blockquote Styling)
- **编辑模式引用样式**:
  - **左侧边框**: 为引用块添加明显的左侧边框（4px 宽度），增强视觉区分度。
  - **字符淡化**: 将 Markdown 引用符号 `>` 的颜色淡化并降低透明度，减少视觉干扰，突出引用内容。
  - **文本样式**: 引用块内的文本颜色调整为浅灰色，与正文区分。

### 2.9 标题样式分级 (Header Hierarchy)
- **字体大小区分**: 实现了编辑区域 H1-H6 标题的字体大小分级，增强视觉层级感。
  - H1: 2.0em (Bold)
  - H2: 1.75em (Bold)
  - H3: 1.5em (Bold)
  - H4: 1.25em (Bold)
  - H5: 1.1em (Bold)
  - H6: 1.0em (Bold, Italic, Lighter Color)

### 2.10 图片行内预览 (Inline Image Preview)
- **实时渲染**: 当光标未在图片语法 `![alt](url)` 区域时，自动将 Markdown 源码替换为图片预览组件。
- **预览样式**: 图片直接在行内显示，下方附带 Alt 文本说明（灰色小字），支持圆角和阴影效果。
- **交互逻辑**:
  - **点击编辑**: 点击预览图片即可进入编辑模式，显示原始 Markdown 源码 `![alt](url)` 并将光标定位到该位置。
  - **自动恢复**: 光标移出图片源码区域后，再次自动转换为预览模式。
- **错误处理**: 如果图片加载失败，组件会保留占位空间，Alt 文本仍然可见。
